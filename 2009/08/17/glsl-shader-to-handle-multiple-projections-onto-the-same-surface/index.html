<!DOCTYPE html>


<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="alternate" href="/index.xml" type="application/rss+xml" title="Jotschi&#39;s Blog">
		<link rel="icon" href="http://jotschi.de//favicon.ico">
		<title>GLSL shader to handle multiple projections onto the same surface - Jotschi&#39;s Blog</title>
		
		<link rel="stylesheet" href="http://jotschi.de//css/highlight.js.min.css">
		<link rel="stylesheet" href="http://jotschi.de//css/bootstrap.min.css">
		<link rel="stylesheet" href="http://jotschi.de//css/bootstrap-theme.css">
		<link rel="stylesheet" href="http://jotschi.de//css/theme.css">
		<link rel="stylesheet" href="http://jotschi.de//css/bootie-docs.css">
	</head>

<body role="document">

	
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://jotschi.de//">Jotschi&#39;s Blog</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li ><a href="http://jotschi.de//">Home</a></li>
			
				
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Categories<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
						
							<li><a href="http://jotschi.de//categories/code">Code</a></li>
						
							<li><a href="http://jotschi.de//categories/electronics">Electronics</a></li>
						
							<li><a href="http://jotschi.de//categories/gfx">Gfx</a></li>
						
							<li><a href="http://jotschi.de//categories/linux">Linux</a></li>
						
							<li><a href="http://jotschi.de//categories/random">Random</a></li>
						
							<li><a href="http://jotschi.de//categories/space">Space</a></li>
						
						</ul>
					</li>
				
				</ul>
			</div>
		</div>
	</nav>

<div class="container">

<div class="row">
	<div class="col-sm-8 doc-main">
		<main role="main">
			<article>
				<a id="title"></a>
				<h1 class="doc-entry-title">GLSL shader to handle multiple projections onto the same surface</h1>
				<div class="doc-entry-meta">
					<span><time datetime="2009-08-17">August 17, 2009</time></span>
				</div>
				<section>
					<div class="paragraph">
<p>For my project &lt;a href="http://www.jotschi.de/?page_id=320"&gt;Generating City Models By Using Panorama Images&lt;/a&gt; i have to write a fragment shader that handles multiple projections onto the same surface. The shader must contain condition in which the projection should be handled. In my case i had to decide which projection source should be used to texture the desired model. &lt;a id="more"&gt;&lt;/a&gt;&lt;a id="more-363"&gt;&lt;/a&gt;
I didn&#8217;t want to do alpha blending of each texture. I wanted that only the projection source will be used that would produce the best projection image. For a good projection the angle of which the projection 'light' falls onto the surface must be very low. The second parameter is the distance.</p>
</div>
<div class="paragraph">
<p>For example, imagine a scene with 20 projection sources. One source is very near the target surface but the angle in which the 'light' falls onto the surface is very big so the texture produced by such a source wouldn&#8217;t be that good. Instead there is another projection source which&#8217;s projections angle is very low but the distance is larger than that of the near source. My shader will now pick the second projection source because the first does not match its condtions.</p>
</div>
<div class="paragraph">
<p>Draft of my target shader:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">uniform int nTextures;
uniform sampler2DArray textures;
uniform vec3[] projectPos;
varying vec3 glPos;
varying vec3 normalVec;
void main() {
  int currentTexture=0;
  float minAngle = 360.0f;
  float angleThreshold = 10.0f;
 // Select the texture with the lowest angle
  for(int i =0; i &lt;nTextures; i++){
   float alpha = texture2DArray(textures,vec3(gl_TexCoord[0].xy, i)).a;
   if(alpha != 1.0f) {
     //TODO check calculation of projDirection
      vec3 projDirection =(projectPos-glPos);
      float angle = dot(normalVec,projDirection*-1);
      if(angle&lt;minAngle) {
          minAngle = angle;
      }
    }
  }
  float minDistance= -1.0f;
  // Select the texture with the lowest distance among those around the lowest angle
  for(i=0; i &lt;nTextures; i++){
   float alpha = texture2DArray(textures,vec3(gl_TexCoord[0].xy, i)).a;
   // Condition 1: Must be visible
   if (alpha != 1.0f) {
     //TODO check calculation of projDirection
     vec3 projDirection =( projectPos-glPos);
     float angle = dot(normalVec,projDirection);
     // Condition 2: The angle must be between +-10.0f of the lowest angle
     if(angle&lt;(minAngle+angleThreshold) || angle&gt;(minAngle+angleThreshold)) {
     // TODO check calculation of distance between both points within RÂ³
    float dx = projectPos[i].x - glPos.x;
  float dy = projectPos[i].y - glPos.y;
  float dz = projectPos[i].z - glPos.z;
  float d = Math.sqrt(dx * dx + dy * dy + dz * dz);
    // select the texture with the lowest distance
    if(d&lt;minDistance || minDistance  ==-1.0f)  {
          minDistance = d;
          currentTexture = i;
    }
        }
   }
  }
gl_FragColor = texture2DArray(textures,vec3(gl_TexCoord[0].xy, currentTexture));
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Maybe there is a better way to check if the given sample contains a texture value at the given texture coordinate than checking its alpha value.</p>
</li>
<li>
<p>I use a uniform to handle the size of the sampler2DArray textures array. Maybe you can extract that information within the shader</p>
</li>
<li>
<p>I use uniform vec3[] projectPos; to handle over the positions of the projection sources. Maybe this can be stored in the build in gl_LightSource array?</p>
</li>
</ol>
</div>

				</section>
			</article>
		</main>
	</div> 

	
<div class="col-sm-3 col-sm-offset-1 doc-sidebar">
	<div class="sidebar-module">
		<div class="sidebar-toc">
			<h4>Table of Contents</h4>
			<ul>
				<li><strong><a href="#title">GLSL shader to handle multiple projections onto the same surface</a></strong></li>
			</ul>
			
		</div>
	</div>
	<div class="sidebar-module">
		<h4>Tags</h4>
		<div class="tag-box">
		
        <span class="tag-item"><a href="http://jotschi.de//tags/GLSL">#GLSL</a></span>
        
        <span class="tag-item"><a href="http://jotschi.de//tags/Shader">#Shader</a></span>
        
        <span class="tag-item"><a href="http://jotschi.de//tags/OpenGL">#OpenGL</a></span>
        
		</div>
	</div>
</div>

</div> 


<hr />

<div class="row">
	<div class="col-sm-8">
		<p class="doc-footer-em"><a href="#">Back to TOP</a></p>
	</div>
</div>

</div> 

<footer class="doc-footer">
	
	
</footer>



<script src="http://jotschi.de//js/jquery-1.11.2.min.js"></script>
<script src="http://jotschi.de//js/bootstrap.min.js"></script>

<script src="http://jotschi.de//js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="http://jotschi.de//js/ie10-viewport-bug-workaround.js"></script>

</body>
</html>