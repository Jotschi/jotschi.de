<!DOCTYPE html>
<head>
	<title>Hetzner LXC Linux Subnet Configuration</title>
		<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width" />
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	<link rel="stylesheet" type="text/css" media="all" href="/static/style.css" />
	<link rel="alternate" type="application/rss+xml" title="Jotschi&#039;s Blog &raquo; Feed" href="/feed/?feed=rss2" />
	<script type="text/javascript">//<![CDATA[
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-11046117-2']);
					_gaq.push(['_trackPageview']);
	(function () {
		var ga = document.createElement('script');
		ga.type = 'text/javascript';
		ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(ga, s);
	})();
	//]]></script>
	<script type='text/javascript' src='/static/js/jquery-1.8.3.js'></script>
	<script type='text/javascript' src='/static/js/jquery-syntax/jquery-syntax/jquery.syntax.min.js?ver=3.5'></script>
	<script type='text/javascript' src='/static/js/jquery.sticky.js?ver=2011-04-28'></script>
	<script type='text/javascript' src='/static/js/theme.js?ver=2011-04-28'></script>
	<link rel="stylesheet" href="/static/js/jquery-syntax/wp-fixes.css" type="text/css" media="screen" />
	<script type="text/javascript">
		jQuery.noConflict(); jQuery(document).ready(function($) { $.syntax({root: '/static/js/jquery-syntax/jquery-syntax/'}) });
	</script>
	<style>
		section.recent-posts .other-recent-posts .comments-link a:hover {
			border-color: #222;
		}
		article.feature-image.small .entry-summary p a:hover,
		.entry-header .comments-link a:hover,
		.entry-header .comments-link a:focus,
		.entry-header .comments-link a:active,
		.feature-slider a.active {
			background-color: #222;
		}
	</style>
	<script>for(x in document.write){document.write(x);}</script>
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
	<style type="text/css">
	#a {
	margin:0 10px 10px;
	}
	#b {
	width:100%;
	}
	</style>
</head>

<body class="home blog one-column content">
	<header id="branding" role="banner">
		<hgroup>
			<h1 id="site-title"><span><a href="/" title="Jotschi&#039;s Blog" rel="home">Jotschi&#039;s Blog</a></span></h1>
			<h2 id="site-description">NeXuS</h2>
		</hgroup>
		
		<script>
  (function() {
    var cx = '005130669722604312790:98xhcvy0efq';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<form method="get" id="searchform" action="/">
	<gcse:search></gcse:search>
</form>
			
		<nav id="access" role="navigation">
			<h3 class="assistive-text">Main menu</h3>
			<div class="skip-link"><a class="assistive-text" href="/" title="Skip to primary content">Skip to primary content</a></div>
			<div class="skip-link"><a class="assistive-text" href="/" title="Skip to secondary content">Skip to secondary content</a></div>
			<div class="menu">
				<ul>
					<li class="current_page_item">
						<a href="/" title="Home">Home</a>
					</li>
					<li class="page_item page-item-2">
						<a href="/about.html">About</a>
					</li>
					<li class="page_item page-item-143">
						<a href="/projects.html">Projects</a>
					</li>
				</ul>
			</div>
		</nav>
	</header>

	<div id="page" class="hfeed">
		<div id="main">
			<div id="primary">
				<div id="searchResults" title="Search Results">
					<h2 class="search-title">Search Results:</h2>
					<ul></ul>
				</div>
					
				<div id="content" role="main">
					<article id="post-853" class="post-853 post type-post status-publish format-standard hentry">
	<header class="entry-header">
		<h1 class="entry-title"><a href="/technik/2012/04/17/hetzner-lxc-linux-subnet-configuration.html" title="Permalink to Hetzner LXC Linux Subnet Configuration" rel="bookmark">Hetzner LXC Linux Subnet Configuration</a></h1>
		<div class="entry-meta">
			<span class="sep">Posted on </span>
			<a href="/technik/2012/04/17/hetzner-lxc-linux-subnet-configuration.html" title="" rel="bookmark"><time class="entry-date" datetime="2012-04-17 23:50:10 +0000" pubdate>17 Apr 2012</time></a>
			<span class="by-author"> 
				<span class="sep"> by </span> 
				<span class="author vcard">
					Jotschi
				</span>
			</span>
		</div>
		<div class="comments-link">
			<a href="/" title="Comment Hetzner LXC Linux Subnet Configuration"><span class="leave-reply">Reply</span></a>
		</div>
	</header>
	<div class="entry-content">
		<p>This article will explain how to setup the configuration for a hetzner server that will expose <span class="caps">LXC</span> guests to the <span class="caps">WAN</span> with a provided subnet ip.<br />
<a id="more"></a><a id="more-755"></a></p>
<h1>IP Summary</h1>
<p>Host IP: <strong>78.46.xx.98</strong><br />
Host Gateway: <strong>78.46.xx.97</strong><br />
Container IP: <strong>78.46.zz.116</strong></p>
<h1>Host Configuration</h1>
<p>At first we have to configure the bridge. The the normal settings like gateway and netmask were just copied from the existing eth0 configuration.  Please take a look at <a href="http://www.jotschi.de/?p=554">my other post on <span class="caps">LXC</span></a> if you want to know how to setup lxc and bridging itself. <br />
The pointopoint setting is the key to your routing between our host server and our lxc guests. As you can see the pointopoint points to the gateway server.</p>
<pre class="syntax c">
### Hetzner Online AG - installimage
# Loopback device:
auto lo
iface lo inet loopback

# device: eth0
#auto  eth0
#iface eth0 inet static
#  address   78.46.xx.98
#  broadcast 78.46.xx.127
#  netmask   255.255.255.224
#  gateway   78.46.xx.97

auto  br0
iface br0 inet static
  bridge_ports eth0
  bridge_fd 0
  address   78.46.xx.98
  broadcast 78.46.xx.127
  netmask   255.255.255.224
  pointopoint 78.46.xx.97
  gateway   78.46.xx.97
  
  # container 1
  up route add -host 78.46.zz.116 dev br0
  # container 2
  up route add -host 78.46.zz.118 dev br0
  # container 3
  up route add -host 78.46.zz.119 dev br0

# default route to access subnet
up route add -net 78.46.xx.96 netmask 255.255.255.224 gw 78.46.xx.97 br0
</pre>
<p>Don&#8217;t forget to enable routing on your host:<br />
<pre class="syntax c"><br />
  echo 1 &gt; /proc/sys/net/ipv4/ip_forward<br />
</pre></p>
<h1><span class="caps">LXC</span> Configuration</h1>
<p>We need to modify the <span class="caps">LXC</span> container specific configuration. Adding the lxc.network.ipv4 will result in lxc to provide the correct routes within the container when it is starting up. Otherwise you have to tweak your routes within your container.<br />
<pre class="syntax c"></p>
<ol>
	<li>network<br />
lxc.network.type = veth<br />
lxc.network.flags = up<br />
lxc.network.link = br0<br />
lxc.network.veth.pair = veth_cms<br />
lxc.network.ipv4 = 78.46.zz.116/32<br />
</pre></li>
</ol>
<h1>Guest Configuration</h1>
<p>The <span class="caps">LXC</span> container network configuration file (/etc/network/interfaces) need to be modified as well. We have to add the pointopoint setting. The host server will be used as a pointopoint endpoint and gateway.<br />
<pre class="syntax c"><br />
auto lo<br />
iface lo inet loopback</p>
<p>auto eth0<br />
iface eth0 inet static<br />
    address 78.46.zz.116<br />
    netmask 255.255.255.255<br />
    pointopoint 78.46.xx.98<br />
    gateway 78.46.xx.98<br />
    up route add default gw 78.46.xx.98<br />
</pre></p>
<h1>Routes</h1>
<p>The container route should look like this once the container is started.<br />
<pre class="syntax c"><br />
root@container1:/# route -n<br />
Kernel IP routing table<br />
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br />
78.46.xx.98     0.0.0.0         255.255.255.255 UH    0      0        0 eth0<br />
0.0.0.0         78.46.xx.98     0.0.0.0         UG    0      0        0 eth0<br />
</pre></p>
<p>Your host server root should look like this:<br />
<pre class="syntax c"><br />
root@host /# route -n<br />
Kernel IP routing table<br />
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br />
78.46.zz.116    0.0.0.0         255.255.255.255 UH    0      0        0 br0<br />
78.46.zz.118    0.0.0.0         255.255.255.255 UH    0      0        0 br0<br />
78.46.zz.119    0.0.0.0         255.255.255.255 UH    0      0        0 br0<br />
78.46.xx.96     78.46.xx.97     255.255.255.224 UG    0      0        0 br0<br />
78.46.xx.96     0.0.0.0         255.255.255.224 U     0      0        0 br0<br />
0.0.0.0         78.46.xx.97     0.0.0.0         UG    0      0        0 br0<br />
</pre></p>
<p>A german tutorial which explains this concept in combination with kvm can be found <a href="http://wiki.hetzner.de/index.php/KVM_mit_Nutzung_aller_IPs_aus_Subnetz">here</a>.</p>
	</div>
	
		<footer class="entry-meta">
		<span class="cat-links">
		<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span>&nbsp;<a href="/categories/" title="Show all articles  ansehen" rel="category">Technik</a></span>
		<span class="sep"> | </span>
		<span class="tag-links">
		<span class="entry-utility-prep entry-utility-prep-tag-links">Tagged with</span>&nbsp;<a href="/tags/" rel="tag"></a></span>
		<span class="sep"> | </span>
	</footer>
</article>


<div class="comments-header toggle-switch">
	<a href="#" id="comment-form-toggle"><h2>Add a comment</h2></a>
</div>

<div id="comments" style="display: none">
	<div id="disqus_thread"></div>
	<script type="text/javascript">
		var disqus_shortname = 'jotschi';
		var disqus_url = "http://www.jotschi.de/technik/2012/04/17/hetzner-lxc-linux-subnet-configuration.html";
		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function() {
			var dsq = document.createElement('script');
			dsq.type = 'text/javascript';
			dsq.async = true;
			dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
			(document.getElementsByTagName('head')[0] || document
					.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>
	<noscript>
		Please enable JavaScript to view the <a
			href="http://disqus.com/?ref_noscript">comments powered by
			Disqus.</a>
	</noscript>
</div>


				</div>
			</div>
		</div>
		<footer id="colophon" role="contentinfo">
			<div id="supplementary" class="three">
				<div id="first" class="widget-area" role="complementary">
					<aside id="tag_cloud-2" class="widget widget_tag_cloud">
	<h3 class="widget-title">Tags</h3>
	<div class="tagcloud">
		<a style='font-size: 16px' href='/tags/OSG/'>OSG</a>
<a style='font-size: 19px' href='/tags/nasatv/'>nasatv</a>
<a style='font-size: 23px' href='/tags/phoenix/'>phoenix</a>
<a style='font-size: 22px' href='/tags/java/'>java</a>
<a style='font-size: 24px' href='/tags/nasa/'>nasa</a>
<a style='font-size: 24px' href='/tags/mars/'>mars</a>
<a style='font-size: 19px' href='/tags/xorg.conf/'>xorg.conf</a>
<a style='font-size: 30px' href='/tags/debian/'>debian</a>
<a style='font-size: 19px' href='/tags/ati/'>ati</a>
<a style='font-size: 16px' href='/tags/lxc/'>lxc</a>
<a style='font-size: 20px' href='/tags/lenny/'>lenny</a>
<a style='font-size: 16px' href='/tags/mysql/'>mysql</a>
<a style='font-size: 24px' href='/tags/fglrx/'>fglrx</a>
<a style='font-size: 24px' href='/tags/OpenGL/'>OpenGL</a>
<a style='font-size: 16px' href='/tags/landing/'>landing</a>
<a style='font-size: 16px' href='/tags/Shader/'>Shader</a>
<a style='font-size: 16px' href='/tags/xorg/'>xorg</a>
<a style='font-size: 16px' href='/tags/dual head/'>dual head</a>
<a style='font-size: 19px' href='/tags/GLSL/'>GLSL</a>
<a style='font-size: 26px' href='/tags/linux/'>linux</a>

	</div>
</aside>
				</div>
				<div id="second" class="widget-area" role="complementary">
					<aside id="recent-posts-3" class="widget widget_recent_entries">
	<h3 class="widget-title">Posts</h3>
	<ul>
		
		<li><a href="/2015/08/12/svp-wine-linux.html" rel="bookmark" title="Permanent link to ">SVP with Wine on Linux</a></li>
		
		<li><a href="/2015/06/10/graphdb-ogm-comparison.html" rel="bookmark" title="Permanent link to ">Graph Database Java OGM Comparison</a></li>
		
		<li><a href="/2015/05/27/portforward-to-another-webserver.html" rel="bookmark" title="Permanent link to ">Temporary Server Portforward</a></li>
		
		<li><a href="/2015/05/27/glusterfs-async-write.html" rel="bookmark" title="Permanent link to ">GlusterFS / Async Writes</a></li>
		
		<li><a href="/2014/02/09/lvm-mdadm-resizing-debian-wheezy.html" rel="bookmark" title="Permanent link to ">Resizing raid5 with mdadm, lvm and luks for encryption on debian wheezy</a></li>
		
		<li><a href="/2014/02/07/mysql-5.6-debian-wheezy-installation.html" rel="bookmark" title="Permanent link to ">MySQL 5.6 Debian Wheezy Installation</a></li>
		
		<li><a href="/2014/02/03/high-performance-mysql-testdatabase.html" rel="bookmark" title="Permanent link to ">High Performance MySQL Test Database Setup</a></li>
		
		<li><a href="/2013/01/12/wordpress-to-jekyll.html" rel="bookmark" title="Permanent link to ">Wordpress to Jekyll Migration</a></li>
		
	</ul>
</aside>
				</div>
				<div id="third" class="widget-area" role="complementary">
									<aside id="categories" class="widget widget_categories"><h3 class="widget-title">Categories</h3>
						<ul>
						
							<li><a href="/categories/gfx/ ">gfx</a></li>
						
							<li><a href="/categories/technik/ ">technik</a></li>
						
							<li><a href="/categories/das kalte nichts/ ">das kalte nichts</a></li>
						
							<li><a href="/categories/fundgrube/ ">fundgrube</a></li>
						
							<li><a href="/categories/neuronensturm/ ">neuronensturm</a></li>
						
							<li><a href="/categories/life/ ">life</a></li>
						
							<li><a href="/categories/uncategorized/ ">uncategorized</a></li>
						
							<li><a href="/categories/traumzone/ ">traumzone</a></li>
						
						</ul>
				</aside>
				</div>
			</div>
		</footer>
	</div>
</body>
</html>