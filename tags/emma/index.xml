<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Emma on Jotschi&#39;s Blog</title>
    <link>http://jotschi.de/tags/emma/</link>
    <description>Recent content in Emma on Jotschi&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 03 Dec 2008 22:22:09 +0000</lastBuildDate>
    <atom:link href="http://jotschi.de/tags/emma/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Code Coverage with Emma and CruiseControl</title>
      <link>http://jotschi.de/2008/12/03/code-coverage-with-emma-and-cruisecontrol/</link>
      <pubDate>Wed, 03 Dec 2008 22:22:09 +0000</pubDate>
      
      <guid>http://jotschi.de/2008/12/03/code-coverage-with-emma-and-cruisecontrol/</guid>
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Perhaps you want to display your coverage reports generated by emma within your cruisecontrol installation.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;There are at least three different ways to get this done. I used cruisecontrol-bin-2.8.1 and the way described here.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;1. By using the artifactspublisher you can just store your html emma reports within your artifacts and display them inside of cruise control by using an iframe. More information about this way can be found here: &amp;lt;a href=&#34;http://markmail.org/message/oew5ope3jcdds5az&#34;&amp;gt;&lt;a href=&#34;http://markmail.org/message/oew5ope3jcdds5az&amp;lt;/a&amp;gt&#34; class=&#34;bare&#34;&gt;http://markmail.org/message/oew5ope3jcdds5az&amp;lt;/a&amp;gt&lt;/a&gt;;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;2. Using the method i describe within this post. It is similar to the way junit reports are included by using xsl.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;3. Using EmmaArtifactWidget that ships with cc. I tried to find more information about this widget and how to use it but found none. Usage of widgets is badly documented within cc.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;At first we have to add emma code coverage tasks to the default project called &#39;connectfour&#39;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&amp;lt;project name=&#34;connectfour&#34; default=&#34;all&#34;&amp;gt;
    &amp;lt;target name=&#34;all&#34; depends=&#34;clean, compile, sleep, test,emma.report, jar&#34;/&amp;gt;

    &amp;lt;target name=&#34;clean&#34;&amp;gt;
        &amp;lt;delete dir=&#34;target&#34; quiet=&#34;true&#34; /&amp;gt;
    &amp;lt;/target&amp;gt;

    &amp;lt;property name=&#34;emma.dir&#34; location=&#34;bin/emma&#34; /&amp;gt;
    &amp;lt;property name=&#34;emma.thresholds&#34; value=&#34;class:100,method:100,block:100,line:100&#34; /&amp;gt;

    &amp;lt;path id=&#34;emma.lib&#34;&amp;gt;
      &amp;lt;pathelement location=&#34;lib/emma.jar&#34; /&amp;gt;
      &amp;lt;pathelement location=&#34;lib/emma_ant.jar&#34; /&amp;gt;
    &amp;lt;/path&amp;gt;

    &amp;lt;taskdef resource=&#34;emma_ant.properties&#34; classpathref=&#34;emma.lib&#34; /&amp;gt;

    &amp;lt;target name=&#34;compile&#34;&amp;gt;
        &amp;lt;mkdir dir=&#34;target/classes&#34;/&amp;gt;
        &amp;lt;javac srcdir=&#34;src&#34; destdir=&#34;target/classes&#34; debug=&#34;true&#34; /&amp;gt;
    &amp;lt;/target&amp;gt;

    &amp;lt;target name=&#34;sleep&#34;&amp;gt;
        &amp;lt;echo message=&#34;Sleeping for a while so you can see the build in the new dashboard&#34; /&amp;gt;
        &amp;lt;sleep seconds=&#34;0&#34; /&amp;gt;
    &amp;lt;/target&amp;gt;


   &amp;lt;target name=&#34;emma.instrument&#34;&amp;gt;
      &amp;lt;emma enabled=&#34;true&#34;&amp;gt;
	  &amp;lt;instr instrpath=&#34;target/classes&#34; destdir=&#34;target/classes&#34; metadatafile=&#34;target/test-results/metadata.emma&#34; merge=&#34;true&#34; mode=&#34;overwrite&#34; /&amp;gt;
      &amp;lt;/emma&amp;gt;
   &amp;lt;/target&amp;gt;

    &amp;lt;target name=&#34;emma.report&#34;&amp;gt;
      &amp;lt;emma enabled=&#34;true&#34;&amp;gt;
        &amp;lt;report sourcepath=&#34;src&#34; sort=&#34;+name&#34; metrics=&#34;method:83,block:83,line:74,class:88&#34;&amp;gt;
        &amp;lt;fileset dir=&#34;target/test-results/&#34;&amp;gt;
          &amp;lt;include name=&#34;*.emma&#34; /&amp;gt;
          &amp;lt;include name=&#34;*.ec&#34; /&amp;gt;
        &amp;lt;/fileset&amp;gt;

        &amp;lt;xml outfile=&#34;target/test-results/coverage.xml&#34; depth=&#34;method&#34; /&amp;gt;
        &amp;lt;html outfile=&#34;target/test-results/index.html&#34; depth=&#34;method&#34; columns=&#34;name,class,method,block,line&#34; /&amp;gt;
      &amp;lt;/report&amp;gt;
      &amp;lt;/emma&amp;gt;
    &amp;lt;/target&amp;gt;

    &amp;lt;target name=&#34;test&#34; depends=&#34;compile,emma.instrument&#34;&amp;gt;
        &amp;lt;mkdir dir=&#34;target/test-classes&#34;/&amp;gt;
        &amp;lt;javac srcdir=&#34;test&#34; destdir=&#34;target/test-classes&#34;&amp;gt;
            &amp;lt;classpath&amp;gt;
                &amp;lt;pathelement location=&#34;target/classes&#34;/&amp;gt;
                &amp;lt;pathelement location=&#34;lib/junit.jar&#34;/&amp;gt;
            &amp;lt;/classpath&amp;gt;
        &amp;lt;/javac&amp;gt;

        &amp;lt;mkdir dir=&#34;target/test-results&#34;/&amp;gt;

        &amp;lt;junit haltonfailure=&#34;no&#34; fork=&#34;yes&#34; printsummary=&#34;on&#34;&amp;gt;
            &amp;lt;classpath &amp;gt;
                &amp;lt;pathelement location=&#34;target/classes&#34;/&amp;gt;
                &amp;lt;pathelement location=&#34;lib/junit.jar&#34;/&amp;gt;
                &amp;lt;path refid=&#34;emma.lib&#34; /&amp;gt;
                &amp;lt;pathelement location=&#34;target/test-classes&#34;/&amp;gt;
            &amp;lt;/classpath&amp;gt;

            &amp;lt;jvmarg value=&#34;-Demma.coverage.out.file=target/test-results/coverage.emma&#34; /&amp;gt;
	    &amp;lt;jvmarg value=&#34;-Demma.coverage.out.merge=true&#34; /&amp;gt;

            &amp;lt;formatter type=&#34;brief&#34; usefile=&#34;false&#34;/&amp;gt;
            &amp;lt;formatter type=&#34;xml&#34; /&amp;gt;
            &amp;lt;batchtest todir=&#34;target/test-results&#34; &amp;gt;
                &amp;lt;fileset dir=&#34;target/test-classes&#34; includes=&#34;**/*Test.class&#34;/&amp;gt;
            &amp;lt;/batchtest&amp;gt;
        &amp;lt;/junit&amp;gt;

    &amp;lt;/target&amp;gt;

    &amp;lt;target name=&#34;jar&#34; depends=&#34;compile&#34;&amp;gt;
        &amp;lt;jar jarfile=&#34;target/connectfour.jar&#34; basedir=&#34;target/classes&#34;/&amp;gt;
    &amp;lt;/target&amp;gt;
&amp;lt;/project&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You will have to change the CruiseControl project configuration. The schedule section should look like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt; &amp;lt;schedule interval=&#34;300&#34;&amp;gt;
            &amp;lt;ant anthome=&#34;apache-ant-1.7.0&#34; buildfile=&#34;build.xml&#34; antWorkingDir=&#34;projects/${project.name}&#34;  /&amp;gt;
 &amp;lt;/schedule&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;My full &lt;em&gt;config.xml&lt;/em&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre&gt;&amp;lt;cruisecontrol&amp;gt;
    &amp;lt;project name=&#34;connectfour&#34;&amp;gt;

        &amp;lt;listeners&amp;gt;
            &amp;lt;currentbuildstatuslistener file=&#34;logs/${project.name}/status.txt&#34;/&amp;gt;
        &amp;lt;/listeners&amp;gt;

        &amp;lt;bootstrappers&amp;gt;
            &amp;lt;antbootstrapper anthome=&#34;apache-ant-1.7.0&#34; buildfile=&#34;projects/${project.name}/build.xml&#34; target=&#34;clean&#34; /&amp;gt;
        &amp;lt;/bootstrappers&amp;gt;

        &amp;lt;modificationset quietperiod=&#34;30&#34;&amp;gt;
            &amp;lt;!-- touch any file in connectfour project to trigger a build --&amp;gt;
            &amp;lt;filesystem folder=&#34;projects/${project.name}&#34;/&amp;gt;
        &amp;lt;/modificationset&amp;gt;

        &amp;lt;schedule interval=&#34;300&#34;&amp;gt;
            &amp;lt;ant anthome=&#34;apache-ant-1.7.0&#34; buildfile=&#34;build.xml&#34; antWorkingDir=&#34;projects/${project.name}&#34;  /&amp;gt;
        &amp;lt;/schedule&amp;gt;

        &amp;lt;log&amp;gt;
            &amp;lt;merge dir=&#34;projects/${project.name}/target/test-results&#34;/&amp;gt;
        &amp;lt;/log&amp;gt;

        &amp;lt;publishers&amp;gt;
            &amp;lt;onsuccess&amp;gt;
                &amp;lt;artifactspublisher dest=&#34;artifacts/${project.name}&#34; file=&#34;projects/${project.name}/target/${project.name}.jar&#34;/&amp;gt;
            &amp;lt;/onsuccess&amp;gt;
        &amp;lt;/publishers&amp;gt;

    &amp;lt;/project&amp;gt;
&amp;lt;/cruisecontrol&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Add the following section below for example your testresults tab in &lt;em&gt;cruisecontrol-bin-2.8.1/webapps/cruisecontrol/main.jsp&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre&gt;         &amp;lt;cruisecontrol:tab name=&#34;emmaResults&#34; label=&#34;Emma Results&#34; &amp;gt;
             &amp;lt;%@ include file=&#34;emmadetails.jsp&#34; %&amp;gt;
          &amp;lt;/cruisecontrol:tab&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Add a new file called &lt;em&gt;emmadetails.jsp&lt;/em&gt; in &lt;em&gt;cruisecontrol-bin-2.8.1/webapps/cruisecontrol/&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&amp;lt;%@ taglib uri=&#34;/WEB-INF/cruisecontrol-jsp11.tld&#34; prefix=&#34;cruisecontrol&#34;%&amp;gt;

&amp;lt;cruisecontrol:xsl xslFile=&#34;/xsl/emma.xsl&#34;/&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Add a new xsl file that will parse your CruiseControl xml build log called &lt;em&gt;emma.xsl&lt;/em&gt; in &lt;em&gt;cruisecontrol-bin-2.8.1/webapps/cruisecontrol/xsl/&lt;/em&gt; :&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&amp;lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&amp;gt;
&amp;lt;xsl:stylesheet version=&#34;1.0&#34; xmlns:xsl=&#34;http://www.w3.org/1999/XSL/Transform&#34; xmlns:fo=&#34;http://www.w3.org/1999/XSL/Format&#34;&amp;gt;
	&amp;lt;xsl:output method=&#34;html&#34;/&amp;gt;

	&amp;lt;xsl:template match=&#34;/&#34; mode=&#34;emma&#34;&amp;gt;
		&amp;lt;xsl:if test=&#34;count(/cruisecontrol/report/data/all/package) &amp;amp;gt; 0&#34;&amp;gt;
			&amp;lt;table align=&#34;center&#34; cellpadding=&#34;2&#34; cellspacing=&#34;0&#34; border=&#34;0&#34; width=&#34;98%&#34;&amp;gt;
				&amp;lt;tbody&amp;gt;
					&amp;lt;tr&amp;gt;
						&amp;lt;th class=&#34;checkstyle-sectionheader&#34; colspan=&#34;5&#34; align=&#34;left&#34;&amp;gt;Emma Results&amp;lt;/th&amp;gt;
					&amp;lt;/tr&amp;gt;
					&amp;lt;tr&amp;gt;
						&amp;lt;td class=&#34;checkstyle-sectionheader&#34;&amp;gt;Package&amp;lt;/td&amp;gt;
						&amp;lt;td class=&#34;checkstyle-sectionheader&#34;&amp;gt;Class Coverage&amp;lt;/td&amp;gt;
						&amp;lt;td class=&#34;checkstyle-sectionheader&#34;&amp;gt;Method Coverage&amp;lt;/td&amp;gt;
						&amp;lt;td class=&#34;checkstyle-sectionheader&#34;&amp;gt;Block Coverage&amp;lt;/td&amp;gt;
						&amp;lt;td class=&#34;checkstyle-sectionheader&#34;&amp;gt;Line Coverage&amp;lt;/td&amp;gt;
					&amp;lt;/tr&amp;gt;
					&amp;lt;xsl:for-each select=&#34;/cruisecontrol/report/data/all/package&#34;&amp;gt;
						&amp;lt;xsl:sort select=&#34;@name&#34;/&amp;gt;
						&amp;lt;tr&amp;gt;
							&amp;lt;xsl:if test=&#34;position() mod 2 = 1&#34;&amp;gt;
								&amp;lt;xsl:attribute name=&#34;class&#34;&amp;gt;checkstyle-oddrow&amp;lt;/xsl:attribute&amp;gt;
							&amp;lt;/xsl:if&amp;gt;
							&amp;lt;td&amp;gt;&amp;lt;xsl:value-of select=&#34;@name&#34;/&amp;gt;&amp;lt;/td&amp;gt;
								&amp;lt;xsl:for-each select=&#34;coverage&#34;&amp;gt;
								&amp;lt;td&amp;gt;
									&amp;lt;xsl:value-of select=&#34;@value&#34;/&amp;gt;
								&amp;lt;/td&amp;gt;
							&amp;lt;/xsl:for-each&amp;gt;
						&amp;lt;/tr&amp;gt;
					&amp;lt;/xsl:for-each&amp;gt;
				&amp;lt;/tbody&amp;gt;
			&amp;lt;/table&amp;gt;
		&amp;lt;/xsl:if&amp;gt;
	&amp;lt;/xsl:template&amp;gt;

	&amp;lt;xsl:template match=&#34;/&#34;&amp;gt;
        &amp;lt;xsl:apply-templates select=&#34;.&#34; mode=&#34;emma&#34;/&amp;gt;
    &amp;lt;/xsl:template&amp;gt;
&amp;lt;/xsl:stylesheet&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>