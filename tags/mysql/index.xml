<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Mysql on Jotschi&#39;s Blog</title>
    <link>http://jotschi.de/tags/mysql/</link>
    <description>Recent content in Mysql on Jotschi&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Fri, 07 Feb 2014 11:48:46 +0000</lastBuildDate>
    <atom:link href="http://jotschi.de/tags/mysql/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>MySQL 5.6 Debian Wheezy Installation</title>
      <link>http://jotschi.de/2014/02/07/mysql-5.6-debian-wheezy-installation/</link>
      <pubDate>Fri, 07 Feb 2014 11:48:46 +0000</pubDate>
      
      <guid>http://jotschi.de/2014/02/07/mysql-5.6-debian-wheezy-installation/</guid>
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Just a small snippet on how to setup the MySQL 5.6 database on debian wheezy.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;apt-get install libaio1
groupadd mysql
useradd -r -g mysql mysql
wget -O mysql-5.6.16-debian6.0-x86_64.deb http://downloads.mysql.com/archives/mysql-5.6/mysql-5.6.16-debian6.0-x86_64.deb
dpkg -i mysql-5.6.16-debian6.0-x86_64.deb
cd /usr/local
ln -s /opt/mysql/server-5.6 mysql
cd mysql
scripts/mysql_install_db --user=mysql
chown -R root .
chown -R mysql data
cp support-files/mysql.server /etc/init.d/mysql
mkdir -p /etc/mysql/conf.d/
cp my.cnf /etc/mysql/
echo $&#39;!include /etc/mysql/my.cnf\n!includedir /etc/mysql/conf.d/&#39; &amp;gt; my.cnf
update-rc.d mysql-5.7 defaults
service mysql start
./bin/mysql_secure_installation&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>High Performance MySQL Test Database Setup</title>
      <link>http://jotschi.de/2014/02/03/high-performance-mysql-testdatabase/</link>
      <pubDate>Mon, 03 Feb 2014 19:05:46 +0000</pubDate>
      
      <guid>http://jotschi.de/2014/02/03/high-performance-mysql-testdatabase/</guid>
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Sometimes your unit tests have run against a real database server. This post will not discuss the question whether this is avoidable or not. Please take a look at embedded database server (e.g: HSQLDB for Java and mocking techniques e.g: mockito) if you want to remove this dependency from your test environment.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Instead this post will show how to setup a blazing fast MySQL Server against which you can run your unit tests.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The main performance bonus is gained by the innodb_flush_log_at_trx_commit setting. This setting will change the flush behavior for the mysql server. Additionally linux tmpfs will be used to put the mysql data files directly into ram.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The mysql-tmpfs-wrapper.sh script will be used to replace the /etc/init.d/mysql start script. Symlink this file to /etc/init.d/myql-tmpfs.sh and use the sysv-rc-conf tool to remove the autostart/stop of the original /etc/init.d/mysql script. I used insserv /etc/init.d/mysql-tmpfs.sh to enable autostart for my wrapper script.
{% gist &lt;a href=&#34;https://gist.github.com/Jotschi/8792727&#34; class=&#34;bare&#34;&gt;https://gist.github.com/Jotschi/8792727&lt;/a&gt; %}&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The recreate_mysql_frombarecopy.sh will recreate the tmpfs ramdisk by using a bare copy of the mysql data directory.
{% gist &lt;a href=&#34;https://gist.github.com/Jotschi/8792866&#34; class=&#34;bare&#34;&gt;https://gist.github.com/Jotschi/8792866&lt;/a&gt; %}&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Add this mountpoint to your /etc/fstab file to define the mysql data tmpfs. You can use the stat tool to check the uid and gid for your mysql data directory (e.g: stat /opt/mysql/server-5.6/data)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;none            /opt/mysql/server-5.6/data  tmpfs   defaults,size=1000M,uid=999,gid=1000,mode=0700          0       0&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I suggest to not directly modify the my.cnf file. Instead use the default my.cnf file and add a includedir section to include files in /etc/mysql/conf.d). This step is of course not needed when you use the original debian mysql server.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;[mysqld]
bind-address             = 0.0.0.0

thread_cache_size        = 8
query_cache_size         = 32M
thread_concurrency       = 8
key_buffer_size          = 256M
max_allowed_packet       = 500M
table_open_cache         = 512
sort_buffer_size         = 256M
net_buffer_length        = 8K
read_buffer_size         = 256K
read_rnd_buffer_size     = 8M
myisam_sort_buffer_size  = 64M

innodb_use_native_aio          = false
innodb_data_file_path          = ibdata1:10M:autoextend:max:15360M
innodb_file_format             = Barracuda
innodb_flush_method            = O_DIRECT
innodb_write_io_threads        = 64
innodb_read_io_threads         = 64

#innodb_additional_mem_pool_size = 20M
innodb_buffer_pool_size        = 2G
innodb_log_files_in_group      = 2
innodb_log_buffer_size         = 8M
innodb_log_file_size           = 128M

innodb_flush_log_at_trx_commit = 2
innodb_lock_wait_timeout = 50

max_connect_errors       = 1000000
max_connections          = 350&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The last important step is to create the bare copy. I suggest that you stripdown your mysql as much as possible.
Example:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;1. Drop all databases except (mysql, perfomance_schema, information_schema)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;2. /etc/init.d/mysql stop&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;3. Remove the ibdata and iblogfiles&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;4. /etc/init.d/mysql start&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;5. Mysql should work and should have recreated the ibdata and logfiles&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;6. /etc/init.d/mysql stop&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;7. cp -ra /opt/mysql/server-5.6/data /opt/mysql/server-5.6/databarecopy&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;8. rm -rf /opt/mysql/server-5.6/data/*&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;9. /etc/init.d/mysql-tmpfs.sh start&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;When put into lxc container a jenkins job can be created to restart the container on a regular basis and thus keep the mysql data directoy clean.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Happy testing!&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>