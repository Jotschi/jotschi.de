<!DOCTYPE html>


<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="alternate" href="/index.xml" type="application/rss+xml" title="Jotschi&#39;s Blog">
		<link rel="icon" href="http://jotschi.de/favicon.ico">
		<title>Hetzner LXC Linux Subnet Configuration - Jotschi&#39;s Blog</title>
		
		<link rel="stylesheet" href="http://jotschi.de/css/highlight.js.min.css">
		<link rel="stylesheet" href="http://jotschi.de/css/bootstrap.min.css">
		<link rel="stylesheet" href="http://jotschi.de/css/bootstrap-theme.css">
		<link rel="stylesheet" href="http://jotschi.de/css/theme.css">
		<link rel="stylesheet" href="http://jotschi.de/css/bootie-docs.css">
	</head>

<body role="document">

	
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://jotschi.de/">Jotschi&#39;s Blog</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li ><a href="http://jotschi.de/">Home</a></li>
			
				
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Categories<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
						
							<li><a href="http://jotschi.de/categories/code">Code</a></li>
						
							<li><a href="http://jotschi.de/categories/electronics">Electronics</a></li>
						
							<li><a href="http://jotschi.de/categories/gfx">Gfx</a></li>
						
							<li><a href="http://jotschi.de/categories/linux">Linux</a></li>
						
							<li><a href="http://jotschi.de/categories/random">Random</a></li>
						
							<li><a href="http://jotschi.de/categories/space">Space</a></li>
						
						</ul>
					</li>
				
				</ul>
			</div>
		</div>
	</nav>

<div class="container">

<div class="row">
	<div class="col-sm-8 doc-main">
		<main role="main">
			<article>
				<a id="title"></a>
				<h1 class="doc-entry-title">Hetzner LXC Linux Subnet Configuration</h1>
				<div class="doc-entry-meta">
					<span><time datetime="2012-04-17">April 17, 2012</time></span>
				</div>
				<section>
					<div class="paragraph">
<p>This article will explain how to setup the configuration for a hetzner server that will expose LXC guests to the WAN with a provided subnet ip.</p>
</div>
<div class="sect1">
<h2 id="_ip_summary">IP Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Host IP: <em>78.46.xx.98</em>
Host Gateway: <em>78.46.xx.97</em>
Container IP: <em>78.46.zz.116</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_host_configuration">Host Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At first we have to configure the bridge. The the normal settings like gateway and netmask were just copied from the existing eth0 configuration.  Please take a look at &lt;a href="http://www.jotschi.de/?p=554"&gt;my other post on LXC&lt;/a&gt; if you want to know how to setup lxc and bridging itself.
The pointopoint setting is the key to your routing between our host server and our lxc guests. As you can see the pointopoint points to the gateway server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">### Hetzner Online AG - installimage
# Loopback device:
auto lo
iface lo inet loopback

# device: eth0
#auto  eth0
#iface eth0 inet static
#  address   78.46.xx.98
#  broadcast 78.46.xx.127
#  netmask   255.255.255.224
#  gateway   78.46.xx.97

auto  br0
iface br0 inet static
  bridge_ports eth0
  bridge_fd 0
  address   78.46.xx.98
  broadcast 78.46.xx.127
  netmask   255.255.255.224
  pointopoint 78.46.xx.97
  gateway   78.46.xx.97

  # container 1
  up route add -host 78.46.zz.116 dev br0
  # container 2
  up route add -host 78.46.zz.118 dev br0
  # container 3
  up route add -host 78.46.zz.119 dev br0

# default route to access subnet
up route add -net 78.46.xx.96 netmask 255.255.255.224 gw 78.46.xx.97 br0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Don&#8217;t forget to enable routing on your host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">  echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lxc_configuration">LXC Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We need to modify the LXC container specific configuration. Adding the lxc.network.ipv4 will result in lxc to provide the correct routes within the container when it is starting up. Otherwise you have to tweak your routes within your container.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c"># network
lxc.network.type = veth
lxc.network.flags = up
lxc.network.link = br0
lxc.network.veth.pair = veth_cms
lxc.network.ipv4 = 78.46.zz.116/32</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_guest_configuration">Guest Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The LXC container network configuration file (/etc/network/interfaces) need to be modified as well. We have to add the pointopoint setting. The host server will be used as a pointopoint endpoint and gateway.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">auto lo
iface lo inet loopback

auto eth0
iface eth0 inet static
    address 78.46.zz.116
    netmask 255.255.255.255
    pointopoint 78.46.xx.98
    gateway 78.46.xx.98
    up route add default gw 78.46.xx.98</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routes">Routes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The container route should look like this once the container is started.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">root@container1:/# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
78.46.xx.98     0.0.0.0         255.255.255.255 UH    0      0        0 eth0
0.0.0.0         78.46.xx.98     0.0.0.0         UG    0      0        0 eth0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your host server root should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">root@host /# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
78.46.zz.116    0.0.0.0         255.255.255.255 UH    0      0        0 br0
78.46.zz.118    0.0.0.0         255.255.255.255 UH    0      0        0 br0
78.46.zz.119    0.0.0.0         255.255.255.255 UH    0      0        0 br0
78.46.xx.96     78.46.xx.97     255.255.255.224 UG    0      0        0 br0
78.46.xx.96     0.0.0.0         255.255.255.224 U     0      0        0 br0
0.0.0.0         78.46.xx.97     0.0.0.0         UG    0      0        0 br0</code></pre>
</div>
</div>
<div class="paragraph">
<p>A german tutorial which explains this concept in combination with kvm can be found &lt;a href="http://wiki.hetzner.de/index.php/KVM_mit_Nutzung_aller_IPs_aus_Subnetz"&gt;here&lt;/a&gt;.</p>
</div>
</div>
</div>

				</section>
			</article>
		</main>
	</div> 

	
<div class="col-sm-3 col-sm-offset-1 doc-sidebar">
	<div class="sidebar-module">
		<div class="sidebar-toc">
			<h4>Table of Contents</h4>
			<ul>
				<li><strong><a href="#title">Hetzner LXC Linux Subnet Configuration</a></strong></li>
			</ul>
			
		</div>
	</div>
	<div class="sidebar-module">
		<h4>Tags</h4>
		<div class="tag-box">
		
		</div>
	</div>
</div>

</div> 


<hr />

<div class="row">
	<div class="col-sm-8">
		<p class="doc-footer-em"><a href="#">Back to TOP</a></p>
	</div>
</div>

</div> 

<footer class="doc-footer">
	
	
</footer>



<script src="http://jotschi.de/js/jquery-1.11.2.min.js"></script>
<script src="http://jotschi.de/js/bootstrap.min.js"></script>

<script src="http://jotschi.de/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="http://jotschi.de/js/ie10-viewport-bug-workaround.js"></script>

</body>
</html>