--- 
layout: post
status: publish
published: true
title: LXC (Linux Containers) For Debian Squeeze
author: Jotschi
author_login: admin
author_email: webmaster@jotschi.de
author_url: http://www.Jotschi.de
excerpt: Today i migrated my vservers to LXC. LXC is similar to Linux VServers and OpenVZ but with one big difference. You don't need to install a custom/patched Kernel for LXC since the support is included within the Kernel Mainline. As for Debian Linux VServers support will be dropped in future releases. This means LXC is the way to go. Okay enough talking. Lets get to work.
wordpress_id: 554
wordpress_url: /?p=554
date: 2011-07-04 21:17:11 +00:00
categories: 
- Technik
tags: []

comments: 
- id: 3775
  author: "Dariel Subir\xC3\x83\xC2\xB3s"
  author_email: dsubiros@gmail.com
  author_url: ""
  date: 2011-11-11 02:04:39 +0000
  date_gmt: 2011-11-11 00:04:39 +0000
  content: |-
    Hi Jotschi:
    Thanks for this tutorial.
    
    I really am an ubuntu user, but I'm exploring Debian for a while. Some days ago I ran into LXC virtualization( Ubuntu Lucid for host and guest) and really did it, but didn't like that in new kernels(at least in Ubuntu) the Network Namespace comes disabled.
    Today I wanted to test Debian Squeeze and began in a VBox pc, and tried to use lxc-tools, but that didn't do it with Squeeze. After some googling came into here and just modifing your mirror address and using my own local repo of Squeeze, things worked like a charm.
    
    Awesome thanks for your lxc-debian script.
    
    Dariel
- id: 11164
  author: Gregor
  author_email: gregor.gololicic993@gmail.com
  author_url: http://gregor.gololicic.com
  date: 2012-12-21 21:31:48 +0000
  date_gmt: 2012-12-21 19:31:48 +0000
  content: Thank you for that. This script really helped me. Good job
---
Today i migrated my vservers to LXC. LXC is similar to Linux VServers and OpenVZ but with one big difference. You don't need to install a custom/patched Kernel for LXC since the support is included within the Kernel Mainline. As for Debian Linux VServers support will be dropped in future releases. This means LXC is the way to go. Okay enough talking. Lets get to work.<a id="more"></a><a id="more-554"></a>


<h2>Setup:</h2>

1. Install Linux Containers
{% snippet c %}
apt-get install lxc
{% endsnippet %}

2. Add cgroup mount point:
{% snippet c %}
mkdir -p /var/local/cgroup
echo "cgroup  /var/local/cgroup  cgroup  defaults  0  0" >> /etc/fstab
mount -a
{% endsnippet %}

3. Install bridge utils
{% snippet c %}
apt-get install bridge-utils
{% endsnippet %}

4. Convert your eth0 configuration into a br0 bridge configuration:
{% snippet c %}
# The primary network interface
#auto eth0
#allow-hotplug eth0
#iface eth0 inet static
#address 192.168.10.1
#netmask 255.255.255.0

auto br0
iface br0 inet static
   bridge_ports eth0
   bridge_fd 0
   address 192.168.10.1
   netmask 255.255.255.0
{% endsnippet %}
Please keep in mind that this change might also affect your firewall settings and/or other connections. 

5. Enable IP forwarding
{% snippet c %}
echo 1 > /proc/sys/net/ipv4/ip_forward
{% endsnippet %}

6. Create a new container.
I used a modified version of the lxc-debian template script from Daniel Lezcano which is included in the LXC debian package. It can be found here /usr/lib/lxc/templates/lxc-debian. The modfied version can be downloaded <a href="/downloads/lxc/lxc-debian">here</a>.
{% snippet c %}
wget http://www.jotschi.de/downloads/lxc/lxc-debian
chmod +x lxc-debian
./lxc-debian
./lxc-debian squeeze test 2
{% endsnippet %}
Your container with the name test will be installed at /var/lib/lxc/test.

7. Adapt container network configuration
For my configuration i had to adapt the resolv.conf and the /etc/network/interfaces file.
I changed the nameserver to 192.168.10.1 since my nameserver is running of that ip.
{% snippet c %}
nameserver 192.168.10.1
{% endsnippet %}

I also adapted the container  /etc/network/interfaces file.
{% snippet c %}
auto eth0
iface eth0 inet static
    address 192.168.10.26
    netmask 255.255.255.0
    gateway 192.168.10.1
{% endsnippet %}

You can edit those file outside of your conainer by editing:
{% snippet c %}
/var/lib/lxc/test/rootfs/etc/network/interfaces
/var/lib/lxc/test/rootfs/etc/resolv.conf
{% endsnippet %}

8. Start the container
{% snippet c %}
lxc-start -n test -d
{% endsnippet %}

9. Enter the conainer
{% snippet c %}
lxc-console -n test
{% endsnippet %}

The default login is root/root.

<br/>
Use this manual for migrating linux vservers to lxc:
<a href="http://schmidi2.blog.com/2010/10/25/migrating-from-vserver-to-lxc/">migrating-from-vserver-to-lxc</a>
