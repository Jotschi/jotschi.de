<!DOCTYPE html>


<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="alternate" href="/index.xml" type="application/rss+xml" title="Jotschi&#39;s Blog">
		<link rel="icon" href="http://jotschi.de/favicon.ico">
		<title>Graph Database Java OGM Comparison - Jotschi&#39;s Blog</title>
		
		<link rel="stylesheet" href="http://jotschi.de/css/highlight.js.min.css">
		<link rel="stylesheet" href="http://jotschi.de/css/bootstrap.min.css">
		<link rel="stylesheet" href="http://jotschi.de/css/bootstrap-theme.css">
		<link rel="stylesheet" href="http://jotschi.de/css/theme.css">
		<link rel="stylesheet" href="http://jotschi.de/css/bootie-docs.css">
	</head>

<body role="document">

	
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://jotschi.de/">Jotschi&#39;s Blog</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li ><a href="http://jotschi.de/">Home</a></li>
			
				
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Categories<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
						
							<li><a href="http://jotschi.de/categories/code">Code</a></li>
						
							<li><a href="http://jotschi.de/categories/electronics">Electronics</a></li>
						
							<li><a href="http://jotschi.de/categories/gfx">Gfx</a></li>
						
							<li><a href="http://jotschi.de/categories/linux">Linux</a></li>
						
							<li><a href="http://jotschi.de/categories/random">Random</a></li>
						
							<li><a href="http://jotschi.de/categories/space">Space</a></li>
						
						</ul>
					</li>
				
				</ul>
			</div>
		</div>
	</nav>

<div class="container">

<div class="row">
	<div class="col-sm-8 doc-main">
		<main role="main">
			<article>
				<a id="title"></a>
				<h1 class="doc-entry-title">Graph Database Java OGM Comparison</h1>
				<div class="doc-entry-meta">
					<span><time datetime="2015-06-10">June 10, 2015</time></span>
				</div>
				<section>
					<div class="paragraph">
<p>I have been using graph databases for a while (mostly Neo4j) and i thought it might be a good idea to write down some of the things i noted while using <a href="http://neo4j.com/">Neo4j</a> in combination with <a href="http://projects.spring.io/spring-data-neo4j/">Spring Data Neo4j (SDN)</a>.</p>
</div>
<div class="paragraph">
<p>I also compiled a comparison of various graph databases a while ago. My list only includes Java based graph databases that allow embedding. I won&#8217;t go into details about the feature sets and how those differ between each of those databases. Instead i just point out the most important aspects i noticed while using the OGM&#8217;s and graph databases.</p>
</div>
<h1 id="_graph_databases" class="sect0">Graph Databases</h1>
<div class="sect1">
<h2 id="_neo4j">Neo4j</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://neo4j.com/">Neo4j</a> was the first graph database i have ever used. It is <a href="https://github.com/neo4j">open source</a> and very fast. It also ships directly with a neat little admin ui which can be used to visualize your graph data.
The database is very easy to embed and comes with a powerful query language (cypher). I don&#8217;t know whether there are any other dedicated OGM/ORM layers for Neo4j besides of SDN and blueprint based OGMs.
The licensing on the other hand is not very useful once you decide to embed Neo4j in your application.
Neo4j Community Edition is licensed under GPL. MySQL is also licensed under GPL.
This means when you would not embed the database and only use the provided Neo4j REST API you would not need to license your application under GPL.
Once you embed the database in your application you must license your application under GPL. This gets even worse when you decide to utilize the clustering features. In this case you would need to license your application under AGPL (even if you would use Neo4j though the REST API)</p>
</div>
<div class="paragraph">
<p>The High Availability mode (Master/Slave Replication) can also be used when embedding the database. I wrote a <a href="https://github.com/Jotschi/neo4j-ha-example">dummy project</a> a while ago that contains a working example.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_orientdb">OrientDB</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://orientdb.com/">OrientDB</a> is also open source. There is no cypher but you can use Orient SQL. Embedding is also very easy and the licensing with Apache 2 license is very developer friendly. Tinkerpop support is very good.</p>
</div>
<div class="paragraph">
<p>The blueprint API is the nativ API for orientdb. This means no additional blueprint API implementation is needed when using a blueprint based OGM.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sparsity_sparksee">Sparsity Sparksee</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I have never used "Sparsity Sparksee":http://www.sparsity-technologies.com/ but feature wise it is comparable to the other big graph databases.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_titan_db">Titan DB</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://thinkaurelius.github.io/titan/">Titan DB</a> is an interesting database. The storage layer for this graph database is interchangeable. You can use <a href="http://en.wikipedia.org/wiki/Berkeley_DB">Berkeley DB</a> which is quiet fast but it basically limits the size of nodes you can store and you can&#8217;t use clustering.
Alternatively you can also use <a href="http://cassandra.apache.org/">Cassandra</a>. Cassandra is slower compared to BerkeleyDB but it supports replication.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hypergraphdb">Hypergraphdb</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I have never used this database and can&#8217;t say much about it but my impression is that it is very small and the feature set is limited.</p>
</div>
</div>
</div>
<h1 id="_performance_comparison" class="sect0">Performance comparison</h1>
<div class="paragraph">
<p>The performance comparision is very superficial and you should keep in mind that the usecase for the database should always dictate the choice.
I have just compared low level read and write speed because i was interested in those. The benchmark does not cover any kind of graph traversals. I was merely interessted in the speed it takes each database to output a single node.</p>
</div>
<div class="paragraph">
<p>All tests were executed within in a JVM that also excuted the graph database. I created 10k nodes and read those 10k nodes sequentially and in random order. No warmup phase was added.
As a baseline i choose Neo4j because it got the overall best performance. (less % is better)</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">DB</th>
<th class="tableblock halign-left valign-top">write 10k</th>
<th class="tableblock halign-left valign-top">read 10k seq</th>
<th class="tableblock halign-left valign-top">read 10k random</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Neo4j</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OrientDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">171%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Titan DB (Cassandra)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">314%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">502%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">510%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Titan DB (BerkeleyDB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">205%</p></td>
</tr>
</tbody>
</table>
<h1 id="_ogm_object_graph_mapping" class="sect0">OGM - Object Graph Mapping</h1>
<div class="paragraph">
<p>I created a <a href="https://github.com/Jotschi/graph-ogm-examples">github project</a> that contains examples for all mentioned OGM&#8217;s and graph databases.</p>
</div>
<div class="sect1">
<h2 id="_spring_data_neo4j">Spring Data Neo4j</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I have used SDN a lot and i&#8217;m quiet impressed by it. Getting started is quiet easy and there are a lot of examples out there.</p>
</div>
<div class="paragraph">
<p>SDN uses annotations to map the entities and relationships. Inheritance of objects is directly mapped to the labels of a node. It is possible to create Spring Data Repositories that retrieve objects by using property values or by specifying cypher statements.</p>
</div>
<div class="paragraph">
<p>What i like is the paging cypher support. What i do not like is the amount of classes and interfaces you need to create to interface with your objects but i guess this is always application specific.</p>
</div>
<div class="paragraph">
<p>When mentioning SDN it is important to note the differences between the versions.</p>
</div>
<div class="sect2">
<h3 id="_3_3_x">3.3.x</h3>
<div class="paragraph">
<p><a href="https://github.com/Jotschi/graph-ogm-examples/tree/master/spring-data-neo4j-3.x">Example project</a></p>
</div>
<div class="paragraph">
<p>Example usecase:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User.java - Defines the entity</p>
</li>
<li>
<p>UserRepository.java - Defines the SDN user repository</p>
</li>
<li>
<p>UserRepositoryImpl.java - Defines a SDN repository implementation that may contain custom repository method implementations</p>
</li>
<li>
<p>UserActions.java - Interface that contains the methods (is extended by UserRepository and implemented by UserRepositoryImpl)</p>
</li>
<li>
<p>UserService      - Defines methods that the implementation may use to manipulate user objects.</p>
</li>
<li>
<p>UserServiceImpl  - Implements the defined methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another point that caused a lot of trouble for me was the @Fetch annotation. The getGroups() method would load the full entities (groups) when adding the @Fetch annotation to the method. This could cause to infinitive recursions or huge loading times. At the end i removed nearly all @Fetch annotations from my projects.</p>
</div>
<div class="paragraph">
<p>Instead i used the <a href="http://docs.spring.io/autorepo/docs/spring-data-neo4j/current/api/org/springframework/data/neo4j/support/Neo4jTemplate.html">Neo4jTemplate</a> class in order to populate the returned enitity. When no @Fetch was specified only a shallow object with no properties is returned. Using the neo4jTemplate.fetch() this shallow object could be loaded.</p>
</div>
<div class="paragraph">
<p>Additionally SDN 3.x was/is slow as hell when using a remote Neo4j instead of the embedded one. This is another reason why SDN 4.x was developed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@NodeEntity
public class User extends AbstractPersistable {

	private String lastname;

	private String firstname;

	@Indexed(unique = true)
	private String username;

  @RelatedTo(type = "MEMBER_OF", direction = Direction.OUTGOING, elementClass = Group.class)
	private Set&lt;Group&gt; groups = new HashSet&lt;&gt;();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_x">4.x</h3>
<div class="paragraph">
<p><a href="https://github.com/Jotschi/graph-ogm-examples/tree/master/spring-data-neo4j-4.x">Example project</a></p>
</div>
<div class="paragraph">
<p>SDN 4.x is still in development and is currently not using the Neo4j Core API directly. Instead it relies on the Neo4j REST API. The overall performance for remote connected neo4j servers is faster (compared to SDN 3.3 in remote mode).
I can only guess why Neo4j/Pivotal Software choose this approach but my guess is that they started a rewrite of SDN in preparation for the binary protocol support for neo4j and to speedup SDN when using a remote Neo4j.</p>
</div>
<div class="paragraph">
<p><a href="http://docs.spring.io/spring-data/neo4j/docs/4.0.0.M1/reference/html/">Documentation 4.0.0.M1</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tinkerpop">Tinkerpop</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://tinkerpop.incubator.apache.org/">Tinkerpop</a> is a collection of APIs that allow transparent and easy interfacing with graph databases. The blueprint API is the most low level api which is used to wrap the graph databases native API. By doing so it provides a standarized API which other APIs can use to interface with a graph db through this API layer. The API layer is very thin. There are various wrappers for many graph databases. I have used the <a href="https://github.com/tinkerpop/blueprints/tree/master/blueprints-neo4j2-graph">blueprint neo4j implementation</a>.</p>
</div>
<div class="paragraph">
<p>Tinkerpop Blueprint is generally a good choice when you want to develop your application but you are not yet sure what graph database you will use at the end.</p>
</div>
<div class="paragraph">
<p>There are three OGM&#8217;s that are based upon the blueprint API i have looked at.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/freemo/Ferma-benchmark">Ferma Benchmark</a> contains measurements for Frames, Totorom and Ferma.</p>
</div>
<div class="sect2">
<h3 id="_tinkerpop_2_frames">Tinkerpop 2 - Frames</h3>
<div class="paragraph">
<p><a href="https://github.com/Jotschi/graph-ogm-examples/tree/master/frames">Example project</a></p>
</div>
<div class="paragraph">
<p>The Frames API uses annotations similar to SDN and thus switching from SDN to Frames is not that hard. Indices have to be created separately. Tinkerpop does not support cypher. You would need to write your <a href="http://sql2gremlin.com/">statements in gremlin</a> instead. The project seems not very active and Frames will not be part of Tinkerpop 3.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface User extends AbstractPersistable {

        @Property("firstname")
        public String getFirstname();

        @Property("firstname")
        public void setFirstname(String name);

        @Property("lastname")
        public String getLastname();

        @Property("lastname")
        public void setLastname(String name);

        @Property("username")
        public String getUsername();

        @Property("username")
        public void setUsername(String name);

        @Adjacency(label = "HAS_USER", direction = Direction.OUT)
        public Iterable&lt;Group&gt; getGroups();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tinkerpop_totorom">Tinkerpop - Totorom</h3>
<div class="paragraph">
<p><a href="https://github.com/Jotschi/graph-ogm-examples/tree/master/totorom">Example project</a></p>
</div>
<div class="paragraph">
<p>I guess <a href="https://github.com/BrynCooke/totorom">Totorom</a> could be seen as a successor to Frames. It is faster compared to Frames and it nativly interfaces with the tinkerpop gremlin query API.
The whole OGM is also very small. Many (all?) annotations are gone. Instead of interfaces you write classes which make things a lot easier compared to frames. In frames custom method handlers would need a special annotation (@JavaHandler) and a dedicated handler implementation for the method. With Totorom you just add your custom method.
Unfortunately the project itself is not very active (as for 06/2015).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class User extends AbstractPersistable {

        public static String FIRSTNAME_KEY = "firstname";

        public static String LASTNAME_KEY = "lastname";

        public static String USERNAME_KEY = "username";

        public String getFirstname() {
                return getProperty(FIRSTNAME_KEY);
        }

        public void setFirstname(String name) {
                setProperty(FIRSTNAME_KEY, name);
        }

        public String getLastname() {
                return getProperty(LASTNAME_KEY);
        }

        public void setLastname(String name) {
                setProperty(LASTNAME_KEY, name);
        }

        public String getUsername() {
                return getProperty(USERNAME_KEY);
        }

        public void setUsername(String name) {
                setProperty(USERNAME_KEY, name);
        }

        public List&lt;Group&gt; getGroups() {
                return out("HAS_USER").toList(Group.class);
        }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ferma">Ferma</h3>
<div class="paragraph">
<p>"Example projects":https://github.com/Jotschi/graph-ogm-examples/tree/master/ferma</p>
</div>
<div class="paragraph">
<p>The API of "Ferma":https://github.com/Syncleus/Ferma is very similar to Totorom. Ferma has various operation modes. It also supports the Frames annotations.</p>
</div>
<div class="paragraph">
<p>What i found useful:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ferma is exposing the raw graph API.</p>
</li>
<li>
<p>The project is active as of 06/2015</p>
</li>
<li>
<p>The <a href="http://wiki.syncleus.com/index.php/Ferma">documentation</a> is quite good.</p>
</li>
<li>
<p>The API contains useful method that can improve performance or prevent boilerplate code (e.g: toListExplicit, nextExplicit, nextOrDefault)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class User extends AbstractPersistable {

        public static String FIRSTNAME_KEY = "firstname";

        public static String LASTNAME_KEY = "lastname";

        public static String USERNAME_KEY = "username";

        public String getFirstname() {
                return getProperty(FIRSTNAME_KEY);
        }

        public void setFirstname(String name) {
                setProperty(FIRSTNAME_KEY, name);
        }

        public String getLastname() {
                return getProperty(LASTNAME_KEY);
        }

        public void setLastname(String name) {
                setProperty(LASTNAME_KEY, name);
        }

        public String getUsername() {
                return getProperty(USERNAME_KEY);
        }

        public void setUsername(String name) {
                setProperty(USERNAME_KEY, name);
        }

        public List&lt;Group&gt; getGroups() {
                return out("HAS_USER").toList(Group.class);
        }

}</code></pre>
</div>
</div>
</div>
</div>
</div>

				</section>
			</article>
		</main>
	</div> 

	
<div class="col-sm-3 col-sm-offset-1 doc-sidebar">
	<div class="sidebar-module">
		<div class="sidebar-toc">
			<h4>Table of Contents</h4>
			<ul>
				<li><strong><a href="#title">Graph Database Java OGM Comparison</a></strong></li>
			</ul>
			
		</div>
	</div>
	<div class="sidebar-module">
		<h4>Tags</h4>
		<div class="tag-box">
		
        <span class="tag-item"><a href="http://jotschi.de/tags/java">#java</a></span>
        
        <span class="tag-item"><a href="http://jotschi.de/tags/neo4j">#neo4j</a></span>
        
        <span class="tag-item"><a href="http://jotschi.de/tags/graphdb">#graphdb</a></span>
        
        <span class="tag-item"><a href="http://jotschi.de/tags/ogm">#ogm</a></span>
        
		</div>
	</div>
</div>

</div> 


<hr />

<div class="row">
	<div class="col-sm-8">
		<p class="doc-footer-em"><a href="#">Back to TOP</a></p>
	</div>
</div>

</div> 

<footer class="doc-footer">
	
	
</footer>



<script src="http://jotschi.de/js/jquery-1.11.2.min.js"></script>
<script src="http://jotschi.de/js/bootstrap.min.js"></script>

<script src="http://jotschi.de/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="http://jotschi.de/js/ie10-viewport-bug-workaround.js"></script>

</body>
</html>